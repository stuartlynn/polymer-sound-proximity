
<link rel="import" href='https://rawgit.com/Download/polymer-cdn/master/lib/polymer/polymer.html'>

<dom-module id="sound-thing">
  <template>
    <style>

	  :host {
      }
	  #thing{

        display: inline-block;
        width: 200px;
        height: 200px;
        border-radius: 200px;
		background: -webkit-radial-gradient(50%, 50%, top,red 10%,white 90%);
		background: radial-gradient(at 50% 50%, red 10%,white 90%);
	  }

    </style>
<a href={{source}} target='_blank'>
    <div id='thing'>
		 <content></content>

	</div>
</a>
  </template>
  <script>
    Polymer({
        is: 'sound-thing',
        properties:{
			val: 0,
			sensitivity:10000.0,
			source:'',
            url:{
                type: 'String',
                value: null
            }
		},
        loadSound: function(){
           var getSound = new XMLHttpRequest();
		   getSound.open("GET", this.url, true);
		   getSound.responseType = "arraybuffer";
		   getSound.onload = function() {
		     this.context.decodeAudioData(getSound.response, function(buffer){
				 this.buffer = buffer;

         if(!window.audio_context){
            window.audio_context = new AudioContext()
         }

				 this.context = window.audio_context;
				 this.source = this.context.createBufferSource();
				 this.source.buffer = buffer;
				 this.source.loop = true
				 this.gainNode = this.context.createGain();
				 this.gainNode.gain.value = 0
				 this.t = 0 ;
				 this.source.connect(this.gainNode);
				 this.gainNode.connect(this.context.destination);

				 this.source.start(0);
	       	 }.bind(this))
		   }.bind(this);
		   getSound.send()
        },
        ready: function(){
			window.addEventListener('mousemove',function(e){
				clipping = this.getBoundingClientRect()
				x = (clipping.left + clipping.right)*0.5
				y = (clipping.top  + clipping.bottom)*0.5
				pageWidth = window.innerWidth;
				pageHeight = window.innerHeight;
				dist = Math.pow( (e.pageX-x)/pageWidth,2) +  Math.pow((e.pageY-y)/pageHeight,2)
				val  = Math.exp(-dist/this.sensitivity);
				this.val = val
				if (this.gainNode){
					this.gainNode.gain.value = val;
				}
			}.bind(this));
			this.context = new AudioContext();
			this.loadSound()
        }
	})
  </script>
</dom-module>
